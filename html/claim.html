<!doctype html>
<html lang="zh-Cn">
    <head>
        <title>女生节愿望领取处</title>
        <meta charset="utf-8">
        <meta name="viewport" content="device=width-device,initial-scale=1">
        <meta name="keywords" content="hust,wishswall">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
        <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <script src="https://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"></script>
        <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <style>
            #su{
               text-align: center;
               font-style: italic;
            }
            footer{
                text-align: center;
                padding-top:10px;
            }
        </style>
    </head>
    <body>
        <div class='container'>
            <img class='img-responsive col-sm-2 col-sm-offset-5' src='../src/logo.gif'>
        </div>
        <div class='contaier'>
            <p id='su'>SEEE Student Union</p>
        </div>
        <div class='container'>
            <form class='form-horizontal' method="POST" action='../claim.php' onsubmit="return check()">
                <div class='input-group' id='name'>
                    <span class='input-group-addon'><span class='glyphicon glyphicon-user'></span></span>
                    <input type='text' class='form-control' placeholder="姓名" name='name' required>
                </div>
                <div class='input-group' id='class'>
                    <span class='input-group-addon'><span class='glyphicon glyphicon-th'></span></span>
                    <input type='text' class='form-control' placeholder="班级" name='class' required>
                </div>
                <div class='input-group' id='phonenumber'>
                    <span class='input-group-addon'><span class='glyphicon glyphicon-phone'></span></span>
                    <input type='text' class='form-control' placeholder="手机号码" name='phonenumber' required>
                </div>
                <div class='input-group' id='qq'>
                    <span class='input-group-addon'><span class='glyphicon glyphicon-link'></span></span>
                    <input type='text' class='form-control' placeholder="QQ号码" name='qq' required>
                </div>
                <div class='input-group' id='id'>
                    <span class='input-group-addon'><span class='glyphicon glyphicon-list'></span></span>
                    <input type='text' class='form-control' placeholder="领取愿望的编号" name='id' required>
                </div>
                <div class="col-sm-12 col-xs-12" style="padding-top:10px;">
                    <input type='button' class='btn default-btn btn-danger col-sm-2 col-sm-offset-1 col-xs-3 col-xs-offset-1' onclick='reset()' value='清空'>
                    <input type='submit' class='btn default-btn btn-success col-sm-2 col-sm-offset-1 col-xs-3 col-xs-offset-1' value='提交'>
                    <input type='button' class='btn default-btn btn-info col-sm-2 col-sm-offset-1 col-xs-3 col-xs-offset-1' onclick='getinfo()' value='对方信息'>
                </div>
            </form>
        </div>
        <footer>系统构建&nbsp;|&nbsp;网络部</footer>
        <script>
             function check(){
                for(var i=0;i<=4;i++){
                    if($(".input-group").eq(i).hasClass('has-error')){
                        $(".input-group").eq(i).removeClass('has-error');
                    }
                }
                var bname=$("input[name='name']").val();
                var bclass=$("input[name='class']").val();
                var bphonenumber=$("input[name='phonenumber']").val();
                var bqq=$("input[name='qq']").val();
                var bid=$("input[name='id]").val();
                if(bname.length>4 || bname.length<2){
                    $("input[name='name']").val('');
                    $("input[name='name']").attr('placeholder','请输入真实姓名');
                    $('#name').addClass('has-error');
                    return false;
                }
                if(bclass.length>20 || bclass.length<4){
                    $("input[name='class']").val('');
                    $("input[name='class']").attr('placeholder','请输入正确班级');
                    $('#class').addClass('has-error');
                    return false;
                }
                var pnreg=new RegExp("^[0-9]{11}");
                if(!pnreg.test(bphonenumber)){
                    $("input[name='phonenumber']").val('');
                    $("input[name='phonenumber']").attr('placeholder','请输入正确手机号码');
                    $('#phonenumber').addClass('has-error');
                    return false;
                }
                var qqreg=new RegExp("^[0-9]{5,10}$");
                if(!qqreg.test(bqq)){
                    $("input[name='qq']").val('');
                    $("input[name='qq']").attr('placeholder','请输入正确qq');
                    $('#qq').addClass('has-error');
                    return false;
                }
                var bidreg=new RegExp("^[0-9]*");
                if(!bidreg.test(bid)){
                    $("input[name='id']").val('');
                    $("input[name='id']").attr('placeholder','请输入正确编号');
                    $('#id').addClass('has-error');
                    return false;
                }
                return true;
            }
            function getinfo(){
                var bphonenumber=$("input[name='phonenumber']").val();
                var bname=$("input[name='name']").val();
                var bqq=$("input[name='qq']").val();
                binfo=new Array(bphonenumber,bname,bqq);
                jQuery.ajax({
                    url:'../getinfo.php',
                    data:{trans_data:binfo},
                    dataType:"json",
                    type:'POST',
                    success:function(responseJSON){
                        if(responseJSON==404){
                            ginfo='您未领取愿望或您输入的信息有误';
                        }
                        else if(responseJSON==502){
                            ginfo='未找到愿望信息';
                        }
                        else{
                            ginfo='愿望者信息\n编号:'+String(responseJSON['id'])+'\n姓名:'+String(responseJSON['name'])+'\n班级:'
                            +String(responseJSON['class'])+'\n电话:'+String(responseJSON['phonenumber'])+'\nqq:'+String(responseJSON['qq']);
                        }                       
                        alert(ginfo);
                    },
                    error:function(xmlhttp,textstatus,errorthrown){
                        alert(errorthrown);              
                    }
                });
            }
        </script>
    </body>
</html>